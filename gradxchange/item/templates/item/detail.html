{% extends 'users/base.html' %}
{% load static %}
{% block body %}


<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'item:index' %}">Items</a></li>
        <li class="breadcrumb-item active" aria-current="page">Item Details</li>
    </ol>
</nav>
<!---->
<section style="background-color: #eee;">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6 col-xl-4">
                <div class="card text-black">
                    <img src="{{ item.item_image.url }}" class="img-fluid card-img-top" alt="{{ item.item_name }}">
                    <div class="card-body">
                        <div class="text-center">
                            <h5 class="card-title">{{ item.item_name }}</h5>
                            <p class="text-muted mb-4">Created by @ {{item.user_name}}</p>
                        </div>
                        <div>
                            <div class="d-flex justify-content-between">
                                <span>Description: </span><span>{{ item.item_desc }}</span>
                            </div>

                        </div>
                        <div class="d-flex justify-content-between total font-weight-bold mt-4">
                            <span>Price</span><span>${{ item.item_price }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!---->





<!-- Feedback section -->
<div class="feedback mt-4">
    <h5>Feedback</h5>
    <p>100% Positive feedback (24 reviews)</p>
    <!-- Comment Form - Visible only to authenticated users -->
    {% if user.is_authenticated %}
    <form method="post">
        {% csrf_token %}
        <!-- Comments -->

        <input type="hidden" name="item_id" id="item_id" value="{{ item.id }}">
        <input type="hidden" name="commented_by" id="commented_by" value="{{ request.user }}">
        <textarea class="form-control square-textarea" id="id_body" name="body"
            rows="4">{{ comment_form.body }}</textarea>
        <button class="btn btn-primary mt-2" type="submit">Submit</button>
    </form>
    {% endif %}

    <!-- Like Button -->
    <a id="{{ item.id }}" class="btn-like">
        <img width="30" height="30" src="{% static 'pictures/like.png' %}">
    </a>
</div>

<!-- Existing feedbacks/comments - Visible to all users -->
<section style="background-color: #f7f6f6;">
    <div class="container my-5 py-5 text-dark">
        <div class="row d-flex justify-content-center">
            <div class="col-md-11 col-lg-9 col-xl-7">
                {% for comment in item.comment.all %}
                <div class="d-flex flex-start mb-4">
                    <img class="rounded-circle shadow-1-strong me-3" src="{{ comment.commented_by.profile.image.url }}"
                        alt="avatar" width="65" height="65" />

                    <div class="card w-100">
                        <div class="card-body p-4">
                            <h5>{{ comment.commented_by }}</h5>
                            <p>{{ comment.body }}</p>
                            <p class="small">{{ comment.created }}</p>

                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
<!---->

<!--change Like-->
<script type="text/javascript">
    window.CSRF_TOKEN = "{{ csrf_token }}";
    $(document).on('click', '.btn-like', function () {
        var item_id = this.id;
        $.ajax({
            method: "POST",
            url: '/item/like',
            data: { item_id: item_id, csrfmiddlewaretoken: window.CSRF_TOKEN }
        });
    });
</script>

<!--Clear comment body-->
<script>
    window.addEventListener('load', function () {
        document.getElementById('id_body').value = '';
    });
</script>

{% endblock %}